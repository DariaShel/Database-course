--добавить ограничение ON DELETE, изменить text -> varchar (char) там, где это нужно
--разнести create и insert по разным файлам
--добавить в insert последовательность столбцов

CREATE TABLE Виды_деятельности (
	id_деятельности text PRIMARY KEY,
	название text
);

INSERT INTO Виды_деятельности VALUES 
	('62.01', 'Разработка компьютерного программного обеспечения'),
	('62.02', 'Деятельность консультативная и работы в области компьютерных технологий'),
	('62.09', 'Деятельность, связанная с использованием вычислительной техники и информационных технологий, прочая'),
	('63.11.1', 'Деятельность по созданию и использованию баз данных и информационных ресурсов'),
	('47.11',  'Торговля розничная преимущественно пищевыми продуктами, включая напитки, и табачными изделиями в неспециализированных магазинах'),
	('47.19', 'Торговля розничная прочая в неспециализированных магазинах'),
	('47.91.1', 'Торговля розничная по почте'),
	('47.91.2', 'Торговля розничная, осуществляемая непосредственно при помощи информационно-коммуникационной сети Интернет'),
	('47.91.3', 'Торговля розничная через Интернет-аукционы'),
	('47.91.4', 'Торговля розничная, осуществляемая непосредственно при помощи телевидения, радио, телефона'),
	('47.59.1', 'Торговля розничная мебелью в специализированных магазинах'),
	('47.41', 'Торговля розничная компьютерами, периферийными устройствами к ним и программным обеспечением в специализированных магазинах'),
	('47.78.1', 'Торговля розничная фотоаппаратурой, оптическими приборами и средствами измерений, кроме очков, в специализированных магазинах');

CREATE TABLE Предприятия (
	id_предприятия integer SERIAL PRIMARY KEY,
	название text NOT NULL,
	число_работников integer CHECK (число_работников > 0 AND NOT NULL),
	основной_вид_деятельности text REFERENCES Виды_деятельности ON DELETE SET NULL
);

ALTER TABLE Предприятия
DROP CONSTRAINT ..
ADD CONSTRAINT деятельность REFERENCES Виды_деятельности ON DELETE SET NULL (основной_вид_деятельности);
INSERT INTO Предприятия VALUES
	(5, 'Магазин цветов', 5, '4.4')

INSERT INTO Предприятия VALUES
	(1, 'Какой-то интернет-магазин', 100, '47.91.2'),
	(2, 'Предприятие по разработке ПО', 100, '62.01'),
	(3, 'Ларёк на вашей улице', 7, '47.11'),
	(4, 'Магазин техники', 200, '47.41');

ALTER TABLE Предприятия ALTER COLUMN основной_вид_деятельности SET DEFAULT 7.77;

CREATE TABLE Дополнительный_вид_деятельности (
	id_предприятия integer REFERENCES Предприятия,
	id_деятельности text REFERENCES Виды_деятельности,
	PRIMARY KEY (id_предприятия, id_деятельности)
);

INSERT INTO Дополнительный_вид_деятельности VALUES
	(1, '47.91.3'),
	(1, '47.91.4'),
	(2, '62.02'),
	(2, '62.09'),
	(2, '63.11.1'),
	(3, '47.19'),
	(4, '47.78.1');

CREATE TABLE Работники (
	id_работника integer PRIMARY KEY,
	id_предприятия integer REFERENCES Предприятия,
	фамилия text NOT NULL,
	имя text NOT NULL,
	отчество text,
	должность text NOT NULL
);

INSERT INTO Работники VALUES
	(1, 1, 'Крайнов', 'Илья', 'Игоревич', 'директор'),
	(2, 1, 'Костин', 'Егор', 'Олегович', 'веб-дизайнер'),
	(3, 1, 'Архипова', 'Анастасия', 'Александровна', 'пиар-менеджер'),
	(4, 2, 'Иванов', 'Иван', 'Иванович', 'директор'),
	(5, 2, 'Смирнов', 'Михаил', 'Дмитриевич', 'junior'),
	(6, 2, 'Полевой', 'Сергей', 'Александрович', 'middle'),
	(7, 2, 'Гордеев', 'Илья', 'Игоревич', 'senior'),
	(8, 3, 'Полянин', 'Даниил', 'Глебович', 'владелец'),
	(9, 3, 'Костин', 'Андрей', 'Андреевич', 'продавец'),
	(10, 3, 'Шарунов', 'Евгений', 'Александрович', 'уборщик');

CREATE TABLE Покупатели (
	id_покупателя integer PRIMARY KEY,
	название text NOT NULL
);

INSERT INTO Покупатели VALUES
	(1, 'ИП Кондитер'),
	(2, 'ИСП РАН'),
	(3, 'Фотостудия');

CREATE TABLE Даты_поставок (
	дата date PRIMARY KEY
);

INSERT INTO Даты_поставок VALUES
	('2021-03-12'::DATE),
	('2021-03-24'::DATE),
	('2021-05-06'::DATE),
	('2021-08-17'::DATE);

CREATE TABLE Поставки (
	id_поставки integer PRIMARY KEY,
	id_предприятия integer REFERENCES Предприятия,
	id_покупателя integer REFERENCES Покупатели,
	дата_поставки date REFERENCES Даты_поставок
);

INSERT INTO Поставки VALUES
	(1, 1, 3, '2021-03-12'::DATE),
	(2, 1, 3, '2021-03-24'::DATE),
	(3, 3, 1, '2021-05-06'::DATE),
	(4, 4, 2, '2021-08-17'::DATE);

CREATE TABLE Продукция (
	id_продукции integer PRIMARY KEY,
	название text UNIQUE
);

INSERT INTO Продукция VALUES
	(1, 'Процессор Intel Pentium e8400'),
	(2, 'Компьютер'),
	(3, 'Монитор'),
	(4, 'Клавиатура'),
	(5, 'Мышь'),
	(6, 'Сгущёнка'),
	(7, 'Шоколад'),
	(8, 'Декоративные цветы'),
	(9, 'Вата'),
	(10, 'Зеркало');

CREATE TABLE Поставки_продукция (
	id_поставки integer REFERENCES Поставки,
	id_продукции integer REFERENCES Продукция,
	объём integer CHECK (объём > 0 AND NOT NULL),
	PRIMARY KEY (id_поставки, id_продукции)
);

INSERT INTO Поставки_продукция VALUES
	(1, 8, 100),
	(1, 9, 500),
	(2, 10, 5),
	(3, 6, 50),
	(3, 7, 30),
	(4, 1, 10),
	(4, 2, 10),
	(4, 3, 10),
	(4, 4, 10),
	(4, 5, 10);

CREATE TABLE Срок_годности (
	id_продукции integer REFERENCES Продукция,
	дата_поставки date REFERENCES Даты_поставок,
	срок_годности date NOT NULL,
	PRIMARY KEY (id_продукции, дата_поставки)
);

INSERT INTO Срок_годности VALUES
	(1, '2021-08-17'::DATE, '2031-08-17'::DATE),
	(2, '2021-08-17'::DATE, '2031-08-17'::DATE),
	(3, '2021-08-17'::DATE, '2031-08-17'::DATE),
	(4, '2021-08-17'::DATE, '2031-08-17'::DATE),
	(5, '2021-08-17'::DATE, '2031-08-17'::DATE),
	(6, '2021-05-06'::DATE, '2022-05-01'::DATE),
	(7, '2021-05-06'::DATE, '2022-05-01'::DATE),
	(8, '2021-03-12'::DATE, '2024-03-01'::DATE),
	(9, '2021-03-12'::DATE, '2024-03-01'::DATE),
	(8, '2021-03-24'::DATE, '2031-03-01'::DATE);

CREATE TABLE Товары (
	название text REFERENCES Продукция (название) PRIMARY KEY,
	единица_измерения text NOT NULL,
	закупочная_цена money NOT NULL
);

INSERT INTO Товары VALUES
	('Процессор Intel Pentium e8400', 'шт', 6900::money),
	('Компьютер', 'шт', 50000::money),
	('Монитор', 'шт', 10000::money),
	('Клавиатура', 'шт', 500::money),
	('Мышь', 'шт', 350::money),
	('Сгущёнка', 'шт', 100::money),
	('Шоколад', 'шт', 75::money),
	('Декоративные цветы', 'набор - 12шт', 399::money),
	('Вата', '250г', 833::money),
	('Зеркало', 'шт', 1030::money);

CREATE TABLE Цена_продажи (
	id_предприятия integer REFERENCES Предприятия,
	id_продукции integer REFERENCES Продукция,
	цена_продаж money NOT NULL,
	PRIMARY KEY (id_предприятия, id_продукции)
);

INSERT INTO Цена_продажи VALUES
	(4, 1, 7000::money),
	(4, 2, 55000::money),
	(4, 3, 15000::money),
	(4, 4, 700::money),
	(4, 5, 400::money),
	(1, 8, 500::money),
	(1, 9, 900::money),
	(1, 10, 1500::money),
	(3, 6, 150::money),
	(3, 7, 100::money);
	
	
	
	